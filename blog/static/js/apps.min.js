/*! blogular 2015-09-23 */
"use strict";var blog=angular.module("blog",["ngRoute","ngSanitize","ngCookies","ui.bootstrap","uikit.editor","hc.marked","angularMoment","angular-loading-bar","selectize","ngHolder","blog.user.controllers","blog.tag.controllers","blog.nav.controllers","blog.post.controllers","blog.archive.controllers","blog.comment.controllers","blog.friendship.controllers"]);blog.config(["$routeProvider","$locationProvider","$httpProvider","markedProvider",function($routeProvider,$locationProvider,$httpProvider,markedProvider){$routeProvider.when("/",{templateUrl:"/static/js/partials/post/list.html",controller:"PostListCtrl"}).when("/posts/:id",{templateUrl:"/static/js/partials/post/detail.html",controller:"PostDetailCtrl"}).when("/post/add",{templateUrl:"/static/js/partials/post/edit.html",controller:"PostAddCtrl"}).when("/post/:id",{templateUrl:"/static/js/partials/post/edit.html",controller:"PostEditCtrl"}).when("/archive/:year/:month",{templateUrl:"/static/js/partials/post/list.html",controller:"ArchiveListCtrl"}).when("/tags",{templateUrl:"/static/js/partials/tag/list.html",controller:"TagListCtrl"}).when("/tags/:id",{templateUrl:"/static/js/partials/post/list.html",controller:"TagDetailCtrl"}).when("/users/:id",{templateUrl:"/static/js/partials/post/list.html",controller:"UserListCtrl"}).when("/following",{templateUrl:"/static/js/partials/friendship/list.html",controller:"FollowingListCtrl"}).when("/followed",{templateUrl:"/static/js/partials/friendship/list.html",controller:"FollowedListCtrl"}).when("/signin",{templateUrl:"/static/js/partials/auth/signin.html",controller:"AuthCtrl"}).otherwise({redirectTo:"/"}),markedProvider.setOptions({gfm:!0,highlight:function(code){return hljs.highlightAuto(code).value}}),$locationProvider.html5Mode({enabled:!0,requireBase:!1}),$httpProvider.defaults.xsrfCookieName="csrftoken",$httpProvider.defaults.xsrfHeaderName="X-CSRFToken"}]).run(function(amMoment){amMoment.changeLocale("zh-cn")}),angular.module("blog.archive.controllers",[]).controller("ArchiveListCtrl",["$scope","$rootScope","$http","$location","$routeParams",function($scope,$rootScope,$http,$location,$routeParams){$scope.url="/api/archives/"+$routeParams.year+"/"+$routeParams.month+"/",$rootScope.title="日志归档 - "+$routeParams.year+" - "+$routeParams.month,$http.get($scope.url).success(function(data,status,header,config){$scope.data=data}).error(function(data,status,header,config){}),$scope["delete"]=function(entry){$http["delete"]("/api/entries/"+entry.id+"/").success(function(data,status,header,config){$scope.data.results.splice($scope.data.results.indexOf(entry),1)}).error(function(data,status,header,config){})},$scope.next=function(){$http.get($scope.data.next).success(function(data,status,header,config){$scope.data=data}).error(function(data,status,header,config){})},$scope.previous=function(){$http.get($scope.data.previous).success(function(data,status,header,config){$scope.data=data}).error(function(data,status,header,config){})}}]),angular.module("blog.comment.controllers",[]).controller("CommentListCtrl",["$scope","$rootScope","$routeParams","$http","$location",function($scope,$rootScope,$routeParams,$http,$location){$scope.comment={},$scope.url="/api/comments/"+$routeParams.id+"/",$http.get($scope.url).success(function(data,status,header,config){$scope.data=data}).error(function(data,status,header,config){}),$scope.add=function(){$http.post($scope.url,$scope.comment).success(function(data,status,header,config){$scope.data.results.unshift(data),$scope.comment.content=""}).error(function(data,status,header,config){})},$scope.edit=function(comment){comment.edit=!0},$scope.save=function(comment){$http.put($scope.url+comment.id+"/",comment).success(function(data,status,header,config){comment.edit=!1}).error(function(data,status,header,config){})},$scope.cancel=function(comment){comment.edit=!1},$scope["delete"]=function(comment){$http["delete"]($scope.url+comment.id+"/").success(function(data,status,header,config){$scope.data.results.splice($scope.data.results.indexOf(comment),1)}).error(function(data,status,header,config){})}}]),angular.module("blog.friendship.controllers",[]).controller("FollowingListCtrl",["$scope","$rootScope","$http","$location",function($scope,$rootScope,$http,$location){$rootScope.title="关注我的好友",$scope.editable=!0,$scope.url="/api/following/",$http.get($scope.url).success(function(data,status,header,config){$scope.data=data}).error(function(data,status,header,config){}),$scope["delete"]=function(friend){$http["delete"]($scope.url+friend.id+"/").success(function(data,status,header,config){$scope.data.results.splice($scope.data.results.indexOf(friend),1)}).error(function(data,status,header,config){})}}]).controller("FollowedListCtrl",["$scope","$rootScope","$http","$location",function($scope,$rootScope,$http,$location){$rootScope.title="我关注的好友",$scope.editable=!1,$scope.url="/api/followed/",$http.get($scope.url).success(function(data,status,header,config){$scope.data=data}).error(function(data,status,header,config){})}]),angular.module("blog.nav.controllers",[]).controller("HeaderCtrl",["$scope","$rootScope","$http","$location",function($scope,$rootScope,$http,$location){$scope.auth_url="/rest-auth/user/",$http.get($scope.auth_url).success(function(data,status,header,config){data&&data.username&&($rootScope.authuser=data)}).error(function(data,status,header,config){}),$scope.isActive=function(route){return route===$location.path()},$scope.signout=function(){$http.post("/rest-auth/logout/").success(function(data,status,header,config){$rootScope.authuser=null}).error(function(data,status,header,config){})}}]).controller("SidebarCtrl",["$scope","$http",function($scope,$http){$scope.recententries_url="/api/recententries/",$http.get($scope.recententries_url).success(function(data,status,header,config){$scope.recententries=data}).error(function(data,status,header,config){}),$scope.recentcomments_url="/api/recentcomments/",$http.get($scope.recentcomments_url).success(function(data,status,header,config){$scope.recentcomments=data}).error(function(data,status,header,config){}),$scope.archives_url="/api/archives/",$http.get($scope.archives_url).success(function(data,status,header,config){$scope.archives=data}).error(function(data,status,header,config){})}]),angular.module("blog.post.controllers",[]).controller("PostListCtrl",["$scope","$rootScope","$http","$location",function($scope,$rootScope,$http,$location){$scope.url="/api/entries/",$rootScope.title="首页",$http.get($scope.url).success(function(data,status,header,config){$scope.data=data}).error(function(data,status,header,config){}),$scope["delete"]=function(entry){$http["delete"]($scope.url+entry.id+"/").success(function(data,status,header,config){$scope.data.results.splice($scope.data.results.indexOf(entry),1)}).error(function(data,status,header,config){})},$scope.next=function(){$http.get($scope.data.next).success(function(data,status,header,config){$scope.data=data}).error(function(data,status,header,config){})},$scope.previous=function(){$http.get($scope.data.previous).success(function(data,status,header,config){$scope.data=data}).error(function(data,status,header,config){})}}]).controller("PostDetailCtrl",["$scope","$rootScope","$routeParams","$http","$location",function($scope,$rootScope,$routeParams,$http,$location){$scope.url="/api/entries/"+$routeParams.id+"/",$http.get($scope.url).success(function(data,status,header,config){$scope.entry=data,$rootScope.title=data.title}).error(function(data,status,header,config){})}]).controller("PostAddCtrl",["$scope","$rootScope","$http","$window",function($scope,$rootScope,$http,$window){$scope.url="/api/entries/",$rootScope.title="新建日志",$scope.entry={},$scope.config={create:!0,valueField:"name",labelField:"name",delimiter:"|",placeholder:"添加标签"},$http.get("/api/tags/").success(function(data,status,header,config){$scope.tags=data.results,angular.forEach($scope.tags,function(tag){this.push(tag.name)},data.results)}).error(function(data,status,header,config){}),$scope.save=function(){$http.post($scope.url,$scope.entry).success(function(data,status,header,config){$window.history.back()}).error(function(data,status,header,config){})},$scope.cancel=function(){$window.history.back()}}]).controller("PostEditCtrl",["$scope","$rootScope","$routeParams","$http","$window",function($scope,$rootScope,$routeParams,$http,$window){$http.get("/api/tags/").success(function(data,status,header,config){$scope.tags=data.results,angular.forEach($scope.tags,function(tag){this.push(tag.name)},data.results)}).error(function(data,status,header,config){}),$scope.url="/api/entries/"+$routeParams.id+"/",$http.get($scope.url).success(function(data,status,header,config){$scope.entry=data;var tags=$scope.entry.tags;$scope.entry.tags=[],angular.forEach(tags,function(tag){this.push(tag.name)},$scope.entry.tags),$rootScope.title=data.title}).error(function(data,status,header,config){}),$scope.config={create:!0,valueField:"name",labelField:"name",delimiter:"|",placeholder:"添加标签",onInitialize:function(selectize){}},$scope.save=function(){$http.put($scope.url,$scope.entry).success(function(data,status,header,config){$window.history.back()}).error(function(data,status,header,config){})},$scope.cancel=function(){$window.history.back()}}]),angular.module("blog.tag.controllers",[]).controller("TagListCtrl",["$scope","$rootScope","$http","$location",function($scope,$rootScope,$http,$location){$scope.url="/api/tags/",$rootScope.title="发现",$http.get($scope.url).success(function(data,status,header,config){$scope.data=data}).error(function(data,status,header,config){}),$scope.add=function(tag){$http.post("/api/tagfollowing/",{id:tag.id}).success(function(data,status,header,config){tag.added=!0}).error(function(data,status,header,config){})},$scope["delete"]=function(tag){$http["delete"]("/api/tagfollowing/"+tag.id+"/").success(function(data,status,header,config){tag.added=!1}).error(function(data,status,header,config){})}}]).controller("TagDetailCtrl",["$scope","$rootScope","$http","$location","$routeParams",function($scope,$rootScope,$http,$location,$routeParams){$scope.url="/api/tags/"+$routeParams.id+"/",$http.get($scope.url).success(function(data,status,header,config){$scope.data=data,$rootScope.title="标签"}).error(function(data,status,header,config){})}]),angular.module("blog.user.controllers",[]).controller("UserListCtrl",["$scope","$rootScope","$http","$routeParams",function($scope,$rootScope,$http,$routeParams){$scope.url="/api/users/"+$routeParams.id+"/",$http.get($scope.url).success(function(data,status,header,config){$scope.data=data,$rootScope.title="用户"}).error(function(data,status,header,config){})}]).controller("AuthCtrl",["$scope","$rootScope","$location","$http",function($scope,$rootScope,$location,$http){$scope.message={},$rootScope.title="用户登陆",$scope.signin=function(){$scope.url="/rest-auth/login/",$http.post($scope.url,$scope.user).success(function(data,status,header,config){$rootScope.authuser=data,$location.path("/")}).error(function(data,status,header,config){$scope.message=data})},$scope.hidealert=function(){$scope.message=null}}]);